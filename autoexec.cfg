// =======================================
// Left 4 Dead 2 Autoexec.cfg â€“ Performance & Audio Fix (Optimized)
// =======================================

// ===== Basic Performance =====
mat_queue_mode "2"                    // Multi-core rendering (-1 = auto, 0 = single, 1 = dual, 2 = multi)
cl_forcepreload "1"                   // Preload models and sounds
cl_showfps "1"                        // Show FPS counter
fps_max "0"                           // Uncapped FPS (use 60/144/240 if you prefer cap)

// ===== Graphics Performance =====
mat_picmip "2"                        // Lower texture quality for better FPS
mat_antialias "0"                     // Disable anti-aliasing
mat_forceaniso "0"                    // Disable anisotropic filtering
mat_vsync "0"                         // Disable vertical sync
mat_reducefillrate "1"                // Reduce fill rate
mat_hdr_level "0"                     // Disable HDR for better performance
mat_colorcorrection "0"               // Disable color correction
mat_bloom_scalefactor_scalar "0"      // Disable bloom effect
r_shadowrendertotexture "0"           // Disable shadow rendering to texture
r_shadows "0"                         // Disable dynamic shadows
r_dynamic "0"                         // Disable dynamic lighting
r_queued_post_processing "0"          // Disable queued post processing
r_cheapwaterstart "1"                 // Use cheaper water rendering
r_cheapwaterend "1"
r_waterforceexpensive "0"             // Force cheap water
r_waterforcereflectentities "0"       // Disable entity reflections in water

// ===== Audio Fix (Prevents Sound Loss) =====
snd_mix_async "1"                     // Enable async sound mixing
snd_mixahead "0.1"                    // Audio buffer (0.1 is balanced)
snd_async_fullyasync "1"              // Full async audio processing
snd_async_spew_blocking "0"           // Disable blocking audio debug
dsp_enhance_stereo "0"                // Disable stereo enhancement
snd_pitchquality "0"                  // Lower pitch quality for performance
snd_musicvolume "0.1"                 // Lower music volume to prevent audio conflicts
voice_enable "1"                      // Keep voice chat enabled
windows_speaker_config "4"            // Stereo speakers (adjust: 1=headphones, 4=stereo, 6=5.1)

// ===== Network Optimization =====
rate "30000"                          // Data rate (30000 is optimal for most connections)
cl_cmdrate "30"                       // Commands per second to server
cl_updaterate "30"                    // Updates per second from server
cl_interp "0.1"                       // Interpolation delay
cl_interp_ratio "2"                   // Interpolation ratio
cl_lagcompensation "1"                // Enable lag compensation
cl_predict "1"                        // Enable client-side prediction
cl_smooth "1"                         // Enable smoothing

// ===== Model & Physics Performance =====
cl_ragdoll_fade_time "0"              // Instant ragdoll fade
cl_ragdoll_physics_enable "0"         // Disable ragdoll physics
g_ragdoll_fadespeed "10000"           // Fast ragdoll fade
g_ragdoll_lvfadespeed "10000"         // Fast ragdoll fade on low violence
cl_ragdoll_maxcount "0"               // No ragdoll limit
violence_agibs "0"                    // Disable alien gibs
violence_hgibs "0"                    // Disable human gibs

// ===== Particle & Effect Optimization =====
func_break_max_pieces "0"             // No break pieces
r_propsmaxdist "1"                    // Reduce prop rendering distance  
props_break_max_pieces "0"            // No prop break pieces
r_decals "1"                          // Minimal decals
r_decal_cullsize "15"                 // Cull small decals
r_drawdetailprops "0"                 // Disable detail props
r_drawflecks "0"                      // Disable bullet impact flecks
r_3dsky "0"                           // Disable 3D skybox
r_drawropes "0"                       // Disable rope rendering
rope_smooth "0"                       // Disable rope smoothing

// ===== Memory & Threading =====
mat_max_worldmesh_vertices "512"      // Reduce world mesh complexity
r_threaded_particles "1"              // Multi-threaded particles
r_threaded_renderables "1"            // Multi-threaded renderables
r_queued_ropes "1"                    // Queue rope rendering
cl_threaded_bone_setup "1"            // Multi-threaded bone setup

// ===== Additional Optimizations =====
ai_expression_optimization "1"        // Optimize AI expressions
scene_flush_threshold "1024"          // Scene memory management
r_lightaverage "0"                    // Disable light averaging
mat_specular "0"                      // Disable specular lighting
mat_bumpmap "0"                       // Disable bump mapping
r_radiosity "4"                       // Reduce radiosity quality
r_maxmodeldecal "0"                   // No model decals

// ===== Stability Commands =====
developer "0"                         // Disable developer messages
con_enable "1"                        // Enable console
cl_downloadfilter "nosounds"          // Don't download custom sounds
cl_allowdownload "0"                  // Disable file downloads
cl_allowupload "0"                    // Disable file uploads

// ===== Bind Keys (Optional) =====
bind "0" "toggle cl_showfps"         // Toggle FPS display
bind "9" "toggle r_drawothermodels"  // Toggle wallhack (for testing)

// ===== Exec Commands =====
echo "L4D2 Autoexec.cfg loaded successfully!"
echo "Performance optimizations and audio fix applied."

// ===== Host Commands (for when hosting) =====
// Uncomment these if you frequently host games
// sv_consistency "0"
// sv_pure "0"
// mp_gamemode "versus"